import{unified as n}from"unified";import t from"remark-parse";import e from"remark-gfm";import r from"@sindresorhus/slugify";import i from"remark-stringify";import o from"strip-final-newline";import{isMatch as u,parse as a}from"date-fns";import{zonedTimeToUtc as f,formatInTimeZone as c}from"date-fns-tz/esm";function l(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}var h=["yyyy-MM-dd","dd/MM/yyyy","dd/MM/yy","dd-MM-yyyy","dd-MM-yy","dd.MM.yyyy","dd.MM.yy"],s=["HH:mm","HH.mm","hh:mm a","hh:mm A"],d=function n(t){return t.children.map(function(e){var r={};return"list"===e.type?n(t):"listItem"===e.type?(r.checked=e.checked,e.children.map(function(n){if("paragraph"===n.type)return r.text=n.children.map(function(n){return"link"===n.type?n.children[0].value:n.value}).filter(function(n){return!!n}).join(""),r}).filter(function(n){return!!n})):void 0}).filter(function(n){return!!n})};function m(n,t,e){if(!n.s){if(e instanceof y){if(!e.s)return void(e.o=m.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(m.bind(null,n,t),m.bind(null,n,2));n.s=t,n.v=e;var r=n.o;r&&r(n)}}var p=function(p){try{var g,b,M,x,w,k,O,A,I,j,H,S,T;return Promise.resolve(n().use(t).use(e).parse(p)).then(function(t){function p(){for(H in U)(T=(S=U[H]).content.filter(Boolean))&&T.length>0&&(1===T.length&&(S.text=T[0]),S.text=T.join("\n\n")),S.content=T;return U}if(!t)return[];var U={},C=null;g=function(n,t){var e="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(e)return(e=e.call(n)).next.bind(e);if(Array.isArray(n)||(e=function(n,t){if(n){if("string"==typeof n)return l(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(n,t):void 0}}(n))){e&&(n=e);var r=0;return function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.children);var E=function(n,t,e){for(var r;;){var i=n();if(v(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=e();if(o&&o.then){if(!v(o)){r=1;break}o=o.s}}var u=new y,a=m.bind(null,u,2);return(0===r?i.then(c):1===r?o.then(f):(void 0).then(function(){(i=n())?i.then?i.then(c).then(void 0,a):c(i):m(u,1,o)})).then(void 0,a),u;function f(t){o=t;do{if(!(i=n())||v(i)&&!i.v)return void m(u,1,o);if(i.then)return void i.then(c).then(void 0,a);v(o=e())&&(o=o.v)}while(!o||!o.then);o.then(f).then(void 0,a)}function c(n){n?(o=e())&&o.then?o.then(f).then(void 0,a):f(o):m(u,1,o)}}(function(){return!(b=g()).done},0,function(){return M=b.value,Promise.resolve(n().use(e).use(i).stringify(M)).then(function(n){var t,e;(x=o(n)).indexOf("\\_")>-1&&(x=x.replace(/\\_/g,"_")),"heading"===M.type&&3===M.depth?(C=r(M.children[0].value),U[C]={title:M.children[0].value,content:[]}):"paragraph"===M.type&&C?(w=U[C],t=x,e=h.map(function(n){return u(t,n)}),k=e.indexOf(!0)>-1?f(a(t,h[e.indexOf(!0)],new Date),"UTC").toJSON().split("T")[0]:null,O=function(n){var t=s.map(function(t){return u(n,t)});if(t.indexOf(!0)>-1){var e=f(a(n,s[t.indexOf(!0)],new Date),"UTC");return c(e,"UTC","HH:mm")}return null}(x),A=function(n){var t=!1,e={hours:0,minutes:0},r=new RegExp(/([0-9]+)h([0-9]+)m/),i=new RegExp(/([0-9]+)h/);if(n.match(r)){t=!0;var o=n.match(r),u=o[2];e.hours=parseInt(o[1]),e.minutes=parseInt(u)}else if(n.match(i)){t=!0;var a=n.match(i);e.hours=parseInt(a[1]),e.minutes=0}return t?e:null}(x),k&&(w.date=k),O&&(w.time=O),A&&(w.duration=A),w.content.push(x)):"list"===M.type?((I=U[C]).text=x,I.list=d(M).flat()):"html"===M.type?U[C].content.push(M.html):"code"===M.type?((j=U[C]).lang=M.lang,j.text=x):"heading"===M.type&&M.depth>3?U[C].content.push(M.children[0].value):process.env.DEBUG&&(console.log("unhandled token type"),console.log(M))})});return E&&E.then?E.then(p):p()})}catch(n){return Promise.reject(n)}};const y=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(t,e){const r=new n,i=this.s;if(i){const n=1&i?t:e;if(n){try{m(r,1,n(this.v))}catch(n){m(r,2,n)}return r}return this}return this.o=function(n){try{const i=n.v;1&n.s?m(r,1,t?t(i):i):e?m(r,1,e(i)):m(r,2,i)}catch(n){m(r,2,n)}},r},n}();function v(n){return n instanceof y&&1&n.s}export{p as default};
//# sourceMappingURL=parse.js.map
